<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>銘峰輪胎 促銷快查</title>
  <style>
    body { background: #0b0f13; color: #e9f0f6; font-family: 'Noto Sans TC', sans-serif; margin: 0; padding: 20px; }
    .wrap { max-width: 980px; margin: auto; }
    h1 { font-size: 28px; font-weight: 900; }
    .beta { background: #ffd233; color: #111; font-weight: bold; padding: 2px 8px; border-radius: 8px; font-size: 14px; }
    .card { background: #121821; border-radius: 16px; padding: 16px; margin-top: 16px; border: 1px solid rgba(255,255,255,0.08); }
    label { font-size: 14px; color: #b9c7d4; display: block; margin-bottom: 4px; }
    input, select { background: #0f151d; color: #fff; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 10px; width: 100%; margin-bottom: 8px; }
    button { border: none; border-radius: 10px; padding: 10px 16px; font-weight: bold; cursor: pointer; }
    .btn-yellow { background: #ffd233; color: #111; }
    .btn-gray { background: #1b2532; color: #e9f0f6; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; font-size: 14px; }
    th, td { padding: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
    th { color: #b9c7d4; text-align: left; background: #111722; }
    .price-sale { color: #ffd233; font-weight: 700; }
    footer { margin-top: 20px; font-size: 12px; color: #8aa1b1; text-align: center; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>銘峰輪胎 促銷快查 <span class="beta">Beta</span></h1>

    <div class="card">
      <label>直接輸入尺寸（支援 205/55R16、205-55-16、205 55 16 等格式）</label>
      <input id="sizeInput" placeholder="例：205/55R16 91V 或 225/45R18" />
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
        <select id="selWidth"><option value="">胎面寬</option></select>
        <select id="selAspect"><option value="">扁平比</option></select>
        <select id="selRim"><option value="">輪框尺寸</option></select>
        <select id="selBrand"><option value="">品牌</option></select>
        <select id="selPattern"><option value="">花紋/型號</option></select>
        <button class="btn-yellow" id="btnSearch">查詢</button>
        <button class="btn-gray" id="btnReset">清除</button>
        <label class="btn-gray" for="csvFile" style="cursor:pointer;">匯入 CSV</label>
        <input id="csvFile" type="file" accept=".csv" hidden />
      </div>
    </div>

    <div class="card">
      <table id="resultTable">
        <thead>
          <tr>
            <th>品牌</th>
            <th>花紋/型號</th>
            <th>尺寸</th>
            <th>規格</th>
            <th>原價</th>
            <th>促銷價</th>
            <th>年份</th>
            <th>數量</th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>

    <footer>© 銘峰輪業 ｜ Demo 版本，實際促銷以門市公告為準。</footer>
  </div>

  <script>
  let promos = []; // 預設為空，可按「匯入 CSV」載入資料

  const $ = s => document.querySelector(s);

  function uniq(values) { return Array.from(new Set(values.filter(v => v))); }

  function populateFilters() {
    const widths = uniq(promos.map(p => p.width)).sort((a,b)=>a-b);
    const aspects = uniq(promos.map(p => p.aspect)).sort((a,b)=>a-b);
    const rims = uniq(promos.map(p => p.rim)).sort((a,b)=>a-b);
    const brands = uniq(promos.map(p => p.brand)).sort();
    const patterns = uniq(promos.map(p => p.pattern)).sort();
    fillOptions('#selWidth', widths);
    fillOptions('#selAspect', aspects);
    fillOptions('#selRim', rims);
    fillOptions('#selBrand', brands);
    fillOptions('#selPattern', patterns);
  }

  function fillOptions(sel, arr) {
    const el = $(sel);
    el.innerHTML = '<option value="">全部</option>';
    arr.forEach(v => {
      const opt = document.createElement('option');
      opt.value = v;
      opt.textContent = v;
      el.appendChild(opt);
    });
  }

  function render(rows) {
    const body = $('#resultBody');
    body.innerHTML = '';
    if (!rows.length) {
      const tr = document.createElement('tr');
      tr.innerHTML = '<td colspan="8" style="color:#b9c7d4;">查無符合條件的資料</td>';
      body.appendChild(tr);
      return;
    }
    rows.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${r.brand||''}</td>
        <td>${r.pattern||''}</td>
        <td>${r.width}/${r.aspect}R${r.rim}</td>
        <td>${(r.load||'')+(r.speed||'')}</td>
        <td>${r.originPrice?`$${r.originPrice}`:''}</td>
        <td class="price-sale">${r.promoPrice?`$${r.promoPrice}`:''}</td>
        <td>${r.year||''}</td>
        <td>${r.qty||''}</td>`;
      body.appendChild(tr);
    });
  }

  function search() {
    const w = $('#selWidth').value;
    const a = $('#selAspect').value;
    const r = $('#selRim').value;
    const b = $('#selBrand').value;
    const p = $('#selPattern').value;
    const s = $('#sizeInput').value.trim();
    let filtered = promos;
    if (w) filtered = filtered.filter(x => x.width == w);
    if (a) filtered = filtered.filter(x => x.aspect == a);
    if (r) filtered = filtered.filter(x => x.rim == r);
    if (b) filtered = filtered.filter(x => x.brand == b);
    if (p) filtered = filtered.filter(x => x.pattern == p);
    if (s) {
      const nums = s.match(/\\d+/g);
      if (nums && nums.length >= 2) {
        filtered = filtered.filter(x => String(x.width).includes(nums[0]) && String(x.aspect).includes(nums[1]));
      }
    }
    render(filtered);
  }

  function resetAll() {
    $('#sizeInput').value = '';
    ['#selWidth','#selAspect','#selRim','#selBrand','#selPattern'].forEach(s => $(s).value='');
    render(promos);
  }

  $('#btnSearch').addEventListener('click', search);
  $('#btnReset').addEventListener('click', resetAll);
  $('#csvFile').addEventListener('change', async (e) => {
    const f = e.target.files?.[0]; if (!f) return;
    const text = await f.text();
    const lines = text.split(/\\r?\\n/).filter(Boolean);
    const headers = lines[0].split(',');
    promos = lines.slice(1).map(line => {
      const cols = line.split(',');
      const obj = {};
      headers.forEach((h,i)=> obj[h.trim()] = cols[i]?.trim() || '');
      obj.width = parseInt(obj.width)||'';
      obj.aspect = parseInt(obj.aspect)||'';
      obj.rim = parseInt(obj.rim)||'';
      return obj;
    });
    populateFilters();
    render(promos);
    alert(`已匯入 ${promos.length} 筆資料`);
  });
  </script>
</body>
</html>
